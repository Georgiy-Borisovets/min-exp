upstream auth-service {
    server auth:8000 weight=1;
}

upstream test-service {
    server test:8080 weight=1;
}

server {
    listen 80;
    server_name mic-exp.loc;

    location /api/auth {
        proxy_pass http://auth-service;
    }

    location /api/test {
        auth_request /api/auth;

        proxy_pass http://test-service;
    }

    location / {
        root /var/www/public;
        try_files $uri /index.html;
    }
}